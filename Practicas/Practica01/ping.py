#!/usr/bin/python
import sys
from os import system as system_call

aux_file = "pops"
# Falta tunear un poco los valores para que
# no sea un valor fijo sino un rango
valores = {"64":"Linux/Unix/FreeBSD"
           ,"128":"Windows"
           ,"32":"Windows"
           ,"254":"Solaris/AIX"
}

# hacemos 3 intentos de ping,
# Mandamos el resultaod a un archivo
def pinging(hostname):
    response = system_call("ping -c 3 " + hostname + " > " + aux_file)
    ttl = getTTL();
    print hostname + " " + valores[str(ttl)]
    system_call("rm "+ aux_file)

# Analizadmos la respuesta, para conocer los valores de ttl
def getTTL():
    f = open(aux_file, 'r')
    ttl = []
    for r in f:
        i=r.find("ttl=")
        if i > 0 :
            ttl.append(int(r[i+4:r.find(" ",i)])) 
            
    f.close()  
    return sum(ttl) / len(ttl)


if len(sys.argv) > 1 :
    pinging(sys.argv[1])
else:
    print "usage: python ping.py <hostname>"



